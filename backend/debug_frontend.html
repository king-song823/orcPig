<!DOCTYPE html>
<html>
<head>
    <title>å‰ç«¯è°ƒè¯•é¡µé¢</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>å‰ç«¯è°ƒè¯•é¡µé¢</h1>
    
    <div>
        <h2>1. æµ‹è¯•åç«¯è¿æ¥</h2>
        <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
        <div id="connection-result"></div>
    </div>
    
    <div>
        <h2>2. æµ‹è¯•æ–‡ä»¶ä¸Šä¼ </h2>
        <input type="file" id="fileInput" multiple accept="image/*">
        <button onclick="testUpload()">æµ‹è¯•ä¸Šä¼ </button>
        <div id="upload-result"></div>
    </div>
    
    <div>
        <h2>3. æµ‹è¯•OCRè¯†åˆ«</h2>
        <button onclick="testOCR()">æµ‹è¯•OCR</button>
        <div id="ocr-result"></div>
    </div>

    <script>
        async function testConnection() {
            const resultDiv = document.getElementById('connection-result');
            try {
                const response = await fetch('http://localhost:8011/parse-docs', {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': 'http://localhost:5173'
                    }
                });
                
                if (response.ok) {
                    resultDiv.innerHTML = '<p style="color: green;">âœ… è¿æ¥æˆåŠŸ</p>';
                } else {
                    resultDiv.innerHTML = `<p style="color: red;">âŒ è¿æ¥å¤±è´¥: ${response.status}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">âŒ è¿æ¥é”™è¯¯: ${error.message}</p>`;
            }
        }
        
        async function testUpload() {
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('upload-result');
            
            if (fileInput.files.length === 0) {
                resultDiv.innerHTML = '<p style="color: orange;">âš ï¸ è¯·å…ˆé€‰æ‹©æ–‡ä»¶</p>';
                return;
            }
            
            const formData = new FormData();
            for (let file of fileInput.files) {
                formData.append('files', file);
                console.log('æ·»åŠ æ–‡ä»¶:', file.name, file.size, file.type);
            }
            
            try {
                resultDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨ä¸Šä¼ ...</p>';
                
                const response = await fetch('http://localhost:8011/parse-docs', {
                    method: 'POST',
                    body: formData
                });
                
                console.log('å“åº”çŠ¶æ€:', response.status);
                console.log('å“åº”å¤´:', response.headers);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('å“åº”æ•°æ®:', data);
                
                resultDiv.innerHTML = `
                    <p style="color: green;">âœ… ä¸Šä¼ æˆåŠŸ</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
            } catch (error) {
                console.error('ä¸Šä¼ é”™è¯¯:', error);
                resultDiv.innerHTML = `<p style="color: red;">âŒ ä¸Šä¼ å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        async function testOCR() {
            const resultDiv = document.getElementById('ocr-result');
            
            // åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨çš„FormData
            const formData = new FormData();
            
            try {
                // å°è¯•ä»åç«¯è·å–ä¸€ä¸ªæµ‹è¯•å›¾ç‰‡
                const testImageResponse = await fetch('http://localhost:8011/test-image');
                if (testImageResponse.ok) {
                    const blob = await testImageResponse.blob();
                    formData.append('files', blob, 'test.jpg');
                } else {
                    resultDiv.innerHTML = '<p style="color: orange;">âš ï¸ æ— æ³•è·å–æµ‹è¯•å›¾ç‰‡</p>';
                    return;
                }
                
                resultDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨è¯†åˆ«...</p>';
                
                const response = await fetch('http://localhost:8011/parse-docs', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('OCRç»“æœ:', data);
                
                resultDiv.innerHTML = `
                    <p style="color: green;">âœ… è¯†åˆ«æˆåŠŸ</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
            } catch (error) {
                console.error('OCRé”™è¯¯:', error);
                resultDiv.innerHTML = `<p style="color: red;">âŒ è¯†åˆ«å¤±è´¥: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
